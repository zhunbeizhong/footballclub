<!DOCTYPE html>
<html>
<head>    
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <link href="../miniui_java/demo/demo.css" rel="stylesheet" type="text/css" />

    <script src="../miniui_java/scripts/boot.js" type="text/javascript"></script>
    <script src="../miniui_java/scripts/miniui/locale/en_US.js" type="text/javascript"></script>
    <script src="../miniui_java/demo/datagrid/js/ColumnsMenu.js" type="text/javascript"></script>
	
    <meta charset="utf-8" />
    <title></title> 
    <!-- layui相关资源引入 -->
    <meta name="renderer" content="webkit">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
 	<link rel="stylesheet" href="../layui/css/layui.css"  media="all">
 	<script src="../layui/layui.js" charset="utf-8"></script>
 	<script src="../js/jquery.min.js"></script>
  <!-- 设置导航栏条目间距 -->
  <style type="text/css">
     #item{
      display: flex;
      flex-direction: row;
      justify-content: space-around;
     }
     #item5{
      margin-left: 200px;
     }
     #item5 #personal{
      color:red;
     }


    /* #players{
      display: flex;
      flex-direction: row;
      align-content: center;
     }*/
     #playersitem1,#playersitem2,#playersitem3{
      display: flex;
      flex-direction: row;
      justify-content: space-between;
     }
		 #test10
		 {
			 height: 800px;
		 }
		 #test10 img{
			  height: 100%;
				width: 100%;
		 }
		 .gcs-footer{

  margin-top: 20px;

  background:#222c3a;

  width: 100%;

  height: 165px;

  text-align: center;

  color: white;

  position: absolute;

}

.gcs-footer .footer-top{

  margin-top: 50px;

}

.gcs-footer a{

  color: #f0f1f1;

  text-decoration: none;

  padding: 0 10px;

  vertical-align:middle;

}

.gcs-footer a:hover{

  color: red;

  text-decoration: underline;

}

.gcs-footer p{

  height: 15px;

  color: #888888;

  margin-top: 30px;

}
    </style>



  <link rel="stylesheet" type="text/css" href="../css/base.css" />       
  <script type="text/javascript" src="../js/common.js"></script>
  <script type="text/javascript" src="../js/parabola.js"></script>
</head>
<body>
<div class="layui-carousel" id="test10">
  <div carousel-item="">
    <div><img src="../images/back1.jpg"></div>
    <div><img src="../images/back2.jpg"></div>
    <div><img src="../images/back3.jpg"></div>
    <div><img src="../images/back4.jpg"></div>
    <div><img src="../images/back5.jpg"></div>
<!--     <div><img src="../images/6.png"></div>
    <div><img src="../images/7.png"></div> -->
  </div>
</div>

<ul class="layui-nav layui-bg-green" id="item">
  <li class="layui-nav-item layui-this" id="item1"><a href="index_User.html">网站首页</a></li>
  <li class="layui-nav-item" id="item2"><a href="buyGoods.html">球队物品购买</a></li>
  <li class="layui-nav-item" id="item4"><a href="#">个人订单</a></li>
  <li class="layui-nav-item" id="item4"><a href="community.html">社区</a></li>
  <li class="layui-nav-item" id="item5"><a href="javascript:;" id="personal">你好<span id="username"></span></a>
    <dl class="layui-nav-child">
      <dd><a href="javascript:;" onclick="edit()">基本资料</a></dd>
      <dd><a href="footballClub/user_exitLogin.action">退出登录</a></dd>
    </dl></li>
</ul>


<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
</fieldset>

    <div id="datagrid1" class="mini-datagrid" style="width:100%;height:500px;" 
        url="footballClub/user_findOrders.action" idField="id" 
        allowResize="true" pageSize="20" 
        allowCellEdit="true" allowCellSelect="true" allowSort="true" 
        editNextOnEnterKey="true"  editNextRowCell="true">
        <div property="columns">
            <div type="indexcolumn">序号</div>
            
            <div name="userName"  field="userName" headerAlign="center" allowSort="true" width="150" >用户
                
            </div>
            <div name="goodName" field="goodName" width="100" allowSort="true" >商品名称
                
            </div> 
            <div name="telPhone" field="telPhone" width="120" headerAlign="center" allowSort="true">联系方式
                
            </div>   
            <div name="address" field="address" width="120" headerAlign="center" allowSort="true">详细地址
                
            </div>         
            <div name="time" field="time" width="100" allowSort="true" dateFormat="yyyy-MM-dd">订单日期
               
            </div>    
            <div name="email" field="email" width="120" headerAlign="center" allowSort="true">电子邮箱
               
            </div>  
            <div name="sex" field="sex" width="120" headerAlign="center" allowSort="true" renderer="onGenderRenderer">性别
                
            </div> 
            <div name="remasks" field="remasks" width="120" headerAlign="center" allowSort="true">备注
                
            </div>
           	
         
        </div>
    </div>
<script>
mini.parse();
layui.use(['carousel', 'form','element'], function(){
  var carousel = layui.carousel
  ,form = layui.form;
  //图片轮播
  carousel.render({
    elem: '#test10'
    ,width: '100%'
    ,height: '440px'
    ,interval: 5000
  });
  
  //事件
  carousel.on('change(test4)', function(res){
    console.log(res)
  });
  
  var $ = layui.$, active = {
    set: function(othis){
      var THIS = 'layui-bg-normal'
      ,key = othis.data('key')
      ,options = {};
      
      othis.css('background-color', '#5FB878').siblings().removeAttr('style'); 
      options[key] = othis.data('value');
      ins3.reload(options);
    }
  };
  
  //监听开关
  form.on('switch(autoplay)', function(){
    ins3.reload({
      autoplay: this.checked
    });
  });
  
  $('.demoSet').on('keyup', function(){
    var value = this.value
    ,options = {};
    if(!/^\d+$/.test(value)) return;
    
    options[this.name] = value;
    ins3.reload(options);
  });
  
  //其它示例
  $('.demoTest .layui-btn').on('click', function(){
    var othis = $(this), type = othis.data('type');
    active[type] ? active[type].call(this, othis) : '';
  });


  var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
  
  //监听导航点击
  element.on('nav(demo)', function(elem){
    //console.log(elem)
    layer.msg(elem.text());
  });



/*   var layer = layui.layer; */
  
  //监听折叠
  element.on('collapse(test)', function(data){
    /*layer.msg('展开状态：'+ data.show);*/
  });

});
//页面刚加载就去显示当前登录的用户名
var currentId=0;
$(function(){
	$.ajax({ 
		  type: "post", 
		  url: "/footballClub/user_findCurrentUser.action", 
		  dataType: "json",
		  success: function(data) { 
		  	//var currentUser=JSON.parse(data);
		  	//从后台传来的data就是json对象不需要转
		  	console.log(data);
		  	currentId=data.id;
		  	document.getElementById("username").innerHTML=data.userName;
		  }, 
		  error: function() { 
		    //console.log("error") 
		    //未登录无法查看订单
			  mini.showMessageBox({title:"未登录", message:"无权查看订单信息，请先登录!",
					 buttons: ["ok"],    
					 iconCls: "mini-messagebox-question",
					 callback:function(){window.location.href="login.html"}
					
				});
		  } 
		});
});


 function edit() {
	if(currentId==0){
		mini.showMessageBox({title:"未登录", message:"请先登录!",
			 buttons: ["ok"],    
			 iconCls: "mini-messagebox-question",
			 callback:function(){window.location.href="login.html"}
			
		});
		
	}else{
        mini.open({
            url: "editUser.html",
            title: "编辑个人信息", width: 600, height: 290,
            onload: function () {
                var iframe = this.getIFrameEl();
                var data = { action: "edit", id:currentId };
                iframe.contentWindow.SetData(data);

            },
            ondestroy: function (action) {
                //var iframe = this.getIFrameEl();

               window.location.reload();

            }
        }); 
	}
   
} 
 
 
 var Genders = [{ id: 1, text: '男' }, { id: 0, text: '女'}];
 function onGenderRenderer(e) {
     for (var i = 0, l = Genders.length; i < l; i++) {
         var g = Genders[i];
         if (g.id == e.value) return g.text;
     }
     return "";
 }
 
 var grid = mini.get("datagrid1");
 grid.load();
 grid.sortBy("time", "desc");

 var menu = new ColumnsMenu(grid);


 grid.on("celleditenter", function (e) {
     var index = grid.indexOf(e.record);
     if (index == grid.getData().length - 1) {
         var row = {};
         grid.addRow(row);
     }
 });

/*  grid.on("beforeload", function (e) {
     if (grid.getChanges().length > 0) {
         if (confirm("有增删改的数据未保存，是否取消本次操作？")) {
             e.cancel = true;
         }
     }
 }); */
 
 function onActionRenderer(e) {
     var grid = e.sender;
     var record = e.record;
     var uid = record._uid;
     var rowIndex = e.rowIndex;

     var s = '<a class="Edit_Button" href="javascript:editRow(\'' + uid + '\')" style="color:blue">修改</a> ';
                
     return s;
     
     function editRow(row_uid) {
         var row = grid.getRowByUID(row_uid);
         if (row) {
             //显示行详细
             grid.hideAllRowDetail();
             grid.showRowDetail(row);

             //将editForm元素，加入行详细单元格内
             var td = grid.getRowDetailCellEl(row);
             td.appendChild(editForm);
             editForm.style.display = "";

             //表单加载员工信息
             var form = new mini.Form("editForm1");
             if (grid.isNewRow(row)) {                    
                 form.reset();
             } else {
                 form.loading();
                 $.ajax({
                     url: "../data/AjaxService.aspx?method=GetEmployee&id=" + row.id,
                     success: function (text) {
                         var o = mini.decode(text);
                         form.setData(o);                            

                         form.unmask();
                     }
                 });
             }

             grid.doLayout();
     
         }
     }
 }
 
 
</script>
<div class="gcs-footer">

  <div class="footer-top">

    <a href="#">百度网</a> |

    <a href="#">新浪网</a> |

    <a href="#">腾迅网</a> |

    <a href="#">网易</a> |

    <a href="#">谷歌</a> |

    <a href="#">阿里巴巴</a> |

 </div>

  <p>
    <a href="#">
    ©football.luan.com
    </a>
  </p>

</div>

</body>
</html>
